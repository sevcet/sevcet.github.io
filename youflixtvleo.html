<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TV YouTube Player</title>

<style>
body, html {
    margin: 0;
    padding: 0;
    background: #000;
    overflow: hidden;
    width: 100%;
    height: 100%;
    font-family: Arial, sans-serif;
}

/* Loading screen */
#loadingScreen {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #000;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 10000;
    color: white;
}
#loadingText {
    margin-top: 20px;
    font-size: 18px;
    text-align: center;
}
.spinner {
    width: 50px;
    height: 50px;
    border: 5px solid #333;
    border-top: 5px solid #ff4444;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* PRAZAN THUMBNAIL â€” za oglase/buffer */
#customThumbnail {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #000;
    opacity: 0;
    z-index: 9998;
    display: none;
}

/* Error screen */
#errorScreen {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #000;
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 10000;
    color: white;
    text-align: center;
    padding: 20px;
}

#playerContainer {
    width: 100%;
    height: 100%;
    position: relative;
}
#player {
    width: 100%;
    height: 100%;
    border: none;
}

/* Progress bar */
#progressContainer {
    position: absolute;
    bottom: 60px;
    left: 5%;
    width: 90%;
    background: rgba(255,255,255,0.2);
    height: 6px;
    border-radius: 3px;
    z-index: 10001;
    opacity: 0;
    transition: opacity 0.3s ease;
}
#progressBar {
    height: 100%;
    background: #ff4444;
    border-radius: 3px;
    width: 0%;
    transition: width 0.1s ease;
}

#infoPanel {
    position: absolute;
    top: 30px;
    left: 30px;
    background: rgba(0,0,0,0.8);
    color: white;
    padding: 12px 18px;
    border-radius: 8px;
    font-size: 16px;
    z-index: 10001;
    opacity: 0;
    transition: opacity 0.3s ease;
    border-left: 4px solid #ff4444;
}

.seek-indicator {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0,0,0,0.8);
    color: white;
    padding: 10px 15px;
    border-radius: 8px;
    font-size: 18px;
    z-index: 10001;
    opacity: 0;
    transition: opacity 0.3s ease;
}
#seekBackward { left: 30px; }
#seekForward { right: 30px; }

/* CC MENU */
#ccMenu {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0,0,0,0.95);
    color: white;
    padding: 20px;
    border-radius: 12px;
    z-index: 10002;
    opacity: 0;
    transition: opacity 0.3s ease;
    width: 400px;
    max-height: 500px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    pointer-events: none;
    display: flex;
    flex-direction: column;
}
#ccMenu.visible {
    opacity: 1;
    pointer-events: all;
}

.menu-title {
    font-size: 20px;
    margin-bottom: 15px;
    text-align: center;
    color: #ff4444;
    border-bottom: 2px solid #333;
    padding-bottom: 10px;
    flex-shrink: 0;
}
.cc-options-container {
    flex: 1;
    overflow-y: auto;
    max-height: 400px;
    padding-right: 5px;
}
.cc-option {
    padding: 12px 15px;
    margin: 5px 0;
    background: rgba(255,255,255,0.1);
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s ease;
    border: 2px solid transparent;
}
.cc-option:hover, .cc-option:focus {
    background: rgba(255,255,255,0.2);
    border-color: #ff4444;
    transform: scale(1.02);
}
.cc-option.selected {
    background: rgba(255,68,68,0.3);
    border-color: #ff4444;
}

.scroll-indicator {
    text-align: center;
    color: #888;
    font-size: 12px;
    margin-top: 10px;
    flex-shrink: 0;
}

#retryButton {
    background: #ff4444;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    margin-top: 20px;
}
</style>
</head>

<body>

<!-- Loading -->
<div id="loadingScreen">
    <div class="spinner"></div>
    <div id="loadingText">UÄitavam YouTube player...</div>
</div>

<!-- PRAZAN THUMBNAIL -->
<div id="customThumbnail"></div>

<!-- Error -->
<div id="errorScreen">
    <div id="errorText">GreÅ¡ka pri uÄitavanju YouTube playera</div>
    <div>Proverite internet konekciju</div>
    <button id="retryButton">POKUÅ AJ PONOVO</button>
</div>

<!-- Player -->
<div id="playerContainer">
    <div id="player"></div>
</div>

<!-- Progress -->
<div id="progressContainer">
    <div id="progressBar"></div>
</div>

<div id="seekBackward" class="seek-indicator">âª -60s</div>
<div id="seekForward" class="seek-indicator">+60s â©</div>

<!-- CC Menu -->
<div id="ccMenu">
    <div class="menu-title">ğŸ¯ Odabir titlova</div>
    <div id="ccOptions" class="cc-options-container">
        <div class="cc-option selected" data-language="off">âŒ Bez titlova</div>
        <div class="cc-option" data-language="en">English ğŸ‡ºğŸ‡¸</div>
        <div class="cc-option" data-language="fr">FranÃ§ais ğŸ‡«ğŸ‡·</div>
        <div class="cc-option" data-language="de">Deutsch ğŸ‡©ğŸ‡ª</div>
        <div class="cc-option" data-language="es">EspaÃ±ol ğŸ‡ªğŸ‡¸</div>
        <div class="cc-option" data-language="it">Italiano ğŸ‡®ğŸ‡¹</div>
        <div class="cc-option" data-language="pt">PortuguÃªs ğŸ‡µğŸ‡¹</div>
        <div class="cc-option" data-language="nl">Nederlands ğŸ‡³ğŸ‡±</div>
        <div class="cc-option" data-language="pl">Polski ğŸ‡µğŸ‡±</div>
        <div class="cc-option" data-language="cs">ÄŒeÅ¡tina ğŸ‡¨ğŸ‡¿</div>
        <div class="cc-option" data-language="sk">SlovenÄina ğŸ‡¸ğŸ‡°</div>
        <div class="cc-option" data-language="sl">SlovenÅ¡Äina ğŸ‡¸ğŸ‡®</div>
        <div class="cc-option" data-language="hr">Hrvatski ğŸ‡­ğŸ‡·</div>
        <div class="cc-option" data-language="bs">Bosanski ğŸ‡§ğŸ‡¦</div>
        <div class="cc-option" data-language="sr">Srpski ğŸ‡·ğŸ‡¸</div>
        <div class="cc-option" data-language="mk">ĞœĞ°ĞºĞµĞ´Ğ¾Ğ½ÑĞºĞ¸ ğŸ‡²ğŸ‡°</div>
        <div class="cc-option" data-language="sq">Shqip ğŸ‡¦ğŸ‡±</div>
        <div class="cc-option" data-language="bg">Ğ‘ÑŠĞ»Ğ³Ğ°Ñ€ÑĞºĞ¸ ğŸ‡§ğŸ‡¬</div>
        <div class="cc-option" data-language="ro">RomÃ¢nÄƒ ğŸ‡·ğŸ‡´</div>
        <div class="cc-option" data-language="hu">Magyar ğŸ‡­ğŸ‡º</div>
        <div class="cc-option" data-language="tr">TÃ¼rkÃ§e ğŸ‡¹ğŸ‡·</div>
        <div class="cc-option" data-language="el">Î•Î»Î»Î·Î½Î¹ÎºÎ¬ ğŸ‡¬ğŸ‡·</div>
        <div class="cc-option" data-language="da">Dansk ğŸ‡©ğŸ‡°</div>
        <div class="cc-option" data-language="sv">Svenska ğŸ‡¸ğŸ‡ª</div>
        <div class="cc-option" data-language="fi">Suomi ğŸ‡«ğŸ‡®</div>
        <div class="cc-option" data-language="no">Norsk ğŸ‡³ğŸ‡´</div>
        <div class="cc-option" data-language="is">Ãslenska ğŸ‡®ğŸ‡¸</div>
        <div class="cc-option" data-language="et">Eesti ğŸ‡ªğŸ‡ª</div>
        <div class="cc-option" data-language="lv">LatvieÅ¡u ğŸ‡±ğŸ‡»</div>
        <div class="cc-option" data-language="lt">LietuviÅ³ ğŸ‡±ğŸ‡¹</div>
        <div class="cc-option" data-language="uk">Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ° ğŸ‡ºğŸ‡¦</div>
        <div class="cc-option" data-language="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹ ğŸ‡·ğŸ‡º</div>
        <div class="cc-option" data-language="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ğŸ‡¸ğŸ‡¦</div>
        <div class="cc-option" data-language="fa">ÙØ§Ø±Ø³ÛŒ ğŸ‡®ğŸ‡·</div>
        <div class="cc-option" data-language="hi">à¤¹à¤¿à¤¨à¥à¤¦à¥€ ğŸ‡®ğŸ‡³</div>
        <div class="cc-option" data-language="bn">à¦¬à¦¾à¦‚à¦²à¦¾ ğŸ‡§ğŸ‡©</div>
        <div class="cc-option" data-language="zh">ä¸­æ–‡ ğŸ‡¨ğŸ‡³</div>
        <div class="cc-option" data-language="ja">æ—¥æœ¬èª ğŸ‡¯ğŸ‡µ</div>
        <div class="cc-option" data-language="ko">í•œêµ­ì–´ ğŸ‡°ğŸ‡·</div>
        <div class="cc-option" data-language="vi">Tiáº¿ng Viá»‡t ğŸ‡»ğŸ‡³</div>
        <div class="cc-option" data-language="id">Bahasa Indonesia ğŸ‡®ğŸ‡©</div>
        <div class="cc-option" data-language="ms">Bahasa Melayu ğŸ‡²ğŸ‡¾</div>
        <div class="cc-option" data-language="th">à¹„à¸—à¸¢ ğŸ‡¹ğŸ‡­</div>
    </div>
    <div class="scroll-indicator">â†‘â†“ za navigaciju â€¢ ENTER za izbor</div>
</div>

<div id="infoPanel"></div>

<script src="https://www.youtube.com/iframe_api"></script>

<script>
let player;
let hideTimeout;
let isPlaying = false;
let isCCMenuOpen = false;
let currentCCSelection = 0;
let progressInterval;
let customThumbnail;
let stateCheckInterval;
let hasAdStarted = false;
let hasVideoStarted = false;

function onYouTubeIframeAPIReady() {
    initializePlayer();
}

function initializePlayer() {
    const urlParams = new URLSearchParams(window.location.search);
    const videoId = urlParams.get('videoId');
    const autoLang = urlParams.get('lang'); // jezik iz aplikacije

    customThumbnail = document.getElementById('customThumbnail');

    if (!videoId) {
        showError("Nema Video ID-a u URL-u");
        return;
    }

    try {
        player = new YT.Player('player', {
            height: '100%',
            width: '100%',
            videoId: videoId,
            playerVars: {
                'autoplay': 1,
                'rel': 0,
                'modestbranding': 1,
                'controls': 0,
                'showinfo': 0,
                'fs': 1,
                'iv_load_policy': 3,
                'disablekb': 1,
                'playsinline': 1,
                'cc_load_policy': 0,
                'enablejsapi': 1
            },
            events: {
                'onReady': event => onPlayerReady(event, autoLang),
                'onStateChange': onPlayerStateChange,
                'onError': onPlayerError
            }
        });
    } catch (error) {
        showError("GreÅ¡ka pri pokretanju playera");
    }
}

function onPlayerReady(event, autoLang) {
    document.getElementById('loadingScreen').style.display = 'none';
    showCustomThumbnail();
    hideControls();
    startAdDetection();
    showInfo("â†â†’ Seek (60s) | â†‘ CC meni | ENTER Play/Pause | BACK Zatvori");

    if (autoLang) autoSelectSubtitles(autoLang);

    try { player.playVideo(); } catch (e) {}
}

/* AUTOMATSKI IZBOR TITLA PREKO CC MENIJA */
function autoSelectSubtitles(lang) {
    const map = {
        "en":"en","fr":"fr","de":"de","es":"es","it":"it","pt":"pt",
        "nl":"nl","pl":"pl","cs":"cs","sk":"sk","sl":"sl",
        "hr":"hr","bs":"bs","sr":"sr",
        "mk":"mk","sq":"sq",
        "bg":"bg","ro":"ro","hu":"hu","tr":"tr","el":"el",
        "da":"da","sv":"sv","fi":"fi","no":"no","is":"is",
        "et":"et","lv":"lv","lt":"lt",
        "uk":"uk","ru":"ru",
        "ar":"ar","fa":"fa","hi":"hi","bn":"bn",
        "zh":"zh","ja":"ja","ko":"ko",
        "vi":"vi","id":"id","ms":"ms","th":"th"
    };

    const target = map[lang] || "off";

    const options = document.querySelectorAll('.cc-option');
    let found = false;

    options.forEach((opt, index) => {
        if (opt.getAttribute("data-language") === target) {
            currentCCSelection = index;
            found = true;
        }
    });

    if (!found) currentCCSelection = 0; // off

    selectCCOption();
}

/* OSTATAK: reklame + DPAD + CC meni */

function onPlayerStateChange(event) {
    if (event.data === YT.PlayerState.PLAYING) {
        hideCustomThumbnail();
        isPlaying = true;
        startProgressTracking();
        checkIfAdOrVideo();
    } else if (event.data === YT.PlayerState.PAUSED) {
        isPlaying = false;
        stopProgressTracking();
    } else if (event.data === YT.PlayerState.ENDED) {
        isPlaying = false;
        stopProgressTracking();
        showCustomThumbnail();
        hasVideoStarted = false;
        hasAdStarted = false;
        showInfo("Video zavrÅ¡en");
    } else if (event.data === YT.PlayerState.BUFFERING) {
        setTimeout(checkBuffering, 2000);
    } else if (event.data === YT.PlayerState.UNSTARTED) {
        showCustomThumbnail();
    }

    resetHideTimer();
}

function checkIfAdOrVideo() {
    if (!player) return;
    const currentTime = player.getCurrentTime();
    if (currentTime === 0 && !hasVideoStarted) hasAdStarted = true;
    else hasVideoStarted = true;
}

function checkBuffering() {
    if (player && player.getPlayerState() === YT.PlayerState.BUFFERING)
        showCustomThumbnail();
}

function startAdDetection() {
    stateCheckInterval = setInterval(function() {
        if (player && player.getPlayerState && player.getCurrentTime) {
            const state = player.getPlayerState();
            const currentTime = player.getCurrentTime();
            if (state === YT.PlayerState.PAUSED && currentTime < 2 && hasAdStarted)
                showCustomThumbnail();
            if (state === YT.PlayerState.BUFFERING && currentTime < 2 && hasAdStarted)
                showCustomThumbnail();
            if (state === YT.PlayerState.UNSTARTED) showCustomThumbnail();
            if (state === YT.PlayerState.ENDED) showCustomThumbnail();
        }
    }, 500);
}

function stopAdDetection() { if (stateCheckInterval) clearInterval(stateCheckInterval); }

function onPlayerError(event) { showError("YouTube greÅ¡ka: " + event.data); }

function showCustomThumbnail() {
    if (customThumbnail && customThumbnail.style.display === 'none')
        customThumbnail.style.display = 'flex';
}
function hideCustomThumbnail() {
    if (customThumbnail && customThumbnail.style.display !== 'none')
        customThumbnail.style.display = 'none';
}

function startProgressTracking() {
    stopProgressTracking();
    progressInterval = setInterval(updateProgress, 1000);
}
function stopProgressTracking() {
    if (progressInterval) {
        clearInterval(progressInterval);
        progressInterval = null;
    }
}
function updateProgress() {
    if (player && player.getCurrentTime && player.getDuration) {
        const currentTime = player.getCurrentTime();
        const duration = player.getDuration();
        const progress = (currentTime / duration) * 100;
        document.getElementById('progressBar').style.width = progress + '%';
    }
}

function seek(direction) {
    if (isCCMenuOpen || !player) return;
    const seekAmount = 60;
    const currentTime = player.getCurrentTime();
    const duration = player.getDuration();
    const newTime = Math.max(0, Math.min(duration, currentTime + (direction * seekAmount)));
    player.seekTo(newTime, true);
}

function togglePlayPause() {
    if (isCCMenuOpen) { selectCCOption(); return; }
    if (isPlaying) player.pauseVideo();
    else player.playVideo();
}

function showCCMenu() {
    const menu = document.getElementById('ccMenu');
    menu.classList.add('visible');
    isCCMenuOpen = true;
    updateCCSelection();
}
function hideCCMenu() {
    const menu = document.getElementById('ccMenu');
    menu.classList.remove('visible');
    isCCMenuOpen = false;
}
function updateCCSelection() {
    const options = document.querySelectorAll('.cc-option');
    options.forEach((option, index) => {
        if (index === currentCCSelection) option.classList.add('selected');
        else option.classList.remove('selected');
    });
}
function navigateCCMenu(direction) {
    if (!isCCMenuOpen) return;
    const options = document.querySelectorAll('.cc-option');
    currentCCSelection += direction;
    if (currentCCSelection < 0) currentCCSelection = options.length - 1;
    else if (currentCCSelection >= options.length) currentCCSelection = 0;
    updateCCSelection();
}
function selectCCOption() {
    if (!player) return;
    const options = document.querySelectorAll('.cc-option');
    const selected = options[currentCCSelection];
    const lang = selected.getAttribute("data-language");

    try {
        if (lang === "off") {
            player.setOption("captions", "track", {});
            player.unloadModule("captions");
        } else {
            player.loadModule("captions");
            setTimeout(() => {
                player.setOption("captions", "track", { languageCode: lang });
                player.setOption("captions", "reload", true);
            }, 100);
        }
    } catch(e){}

    hideCCMenu();
}

function showControls() {
    if (isCCMenuOpen) return;
    document.getElementById('progressContainer').style.opacity = '1';
    resetHideTimer();
}
function hideControls() {
    document.getElementById('progressContainer').style.opacity = '0';
    clearTimeout(hideTimeout);
}
function showControlsTemporary() {
    showControls();
    resetHideTimer();
}
function resetHideTimer() {
    clearTimeout(hideTimeout);
    hideTimeout = setTimeout(hideControls, 3000);
}

function closePlayer() {
    stopProgressTracking();
    stopAdDetection();
    if (window.AndroidInterface) AndroidInterface.closePlayer();
    else window.history.back();
}

function showInfo(message) {
    const infoPanel = document.getElementById('infoPanel');
    infoPanel.textContent = message;
    infoPanel.style.opacity = '1';
    setTimeout(() => infoPanel.style.opacity = '0', 3000);
}

function showError(message) {
    document.getElementById('loadingScreen').style.display = 'none';
    const e = document.getElementById('errorScreen');
    e.style.display = 'flex';
    document.getElementById('errorText').textContent = message;
}
function retryPlayer() {
    document.getElementById('errorScreen').style.display = 'none';
    document.getElementById('loadingScreen').style.display = 'flex';
    initializePlayer();
}

/* DPAD: radi i na tastaturi i na daljincu */
document.addEventListener('keydown', event => {
    showControlsTemporary();

    switch(event.key) {
        case 'ArrowUp':
            if (!isCCMenuOpen) showCCMenu();
            else navigateCCMenu(-1);
            event.preventDefault();
            break;
        case 'ArrowDown':
            if (isCCMenuOpen) navigateCCMenu(1);
            event.preventDefault();
            break;
        case 'Enter':
            if (isCCMenuOpen) selectCCOption();
            else togglePlayPause();
            event.preventDefault();
            break;
        case ' ':
            if (!isCCMenuOpen) togglePlayPause();
            event.preventDefault();
            break;
        case 'ArrowLeft':
            seek(-1);
            event.preventDefault();
            break;
        case 'ArrowRight':
            seek(1);
            event.preventDefault();
            break;
        case 'Escape':
        case 'Backspace':
            if (isCCMenuOpen) hideCCMenu();
            else closePlayer();
            event.preventDefault();
            break;
    }
});

document.addEventListener('mousemove', showControlsTemporary);
document.addEventListener('click', showControlsTemporary);
document.getElementById('retryButton').addEventListener('click', retryPlayer);
window.addEventListener('load', () => setTimeout(hideControls, 2000));
window.addEventListener('beforeunload', () => stopProgressTracking());
</script>

</body>
</html>
