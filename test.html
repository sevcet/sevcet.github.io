<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>YouTube auto-translate to Serbian</title>
<script src="https://www.youtube.com/iframe_api"></script>
<style>
  html, body { margin: 0; padding: 0; height: 100%; background: #000; }
  #player { width: 100%; height: 100%; }
</style>
</head>
<body>

<div id="player"></div>

<script>
  var player;

  function onYouTubeIframeAPIReady() {
    console.log('onYouTubeIframeAPIReady');
    player = new YT.Player('player', {
      videoId: 'dQw4w9WgXcQ', // ili neki drugi video sa engleskim titlovima
      host: 'https://www.youtube.com',
      playerVars: {
        autoplay: 1,
        cc_load_policy: 1,
        controls: 1,
        rel: 0,
        modestbranding: 1
      },
      events: {
        onReady: onPlayerReady,
        onError: onPlayerError,
        onStateChange: onPlayerStateChange
      }
    });
  }

  function onPlayerReady() {
    console.log('Player ready');

    try { player.playVideo(); } catch (e) { console.log('playVideo error:', e); }

    setTimeout(function () {
      try {
        var tracks = player.getOption('captions', 'tracklist');
        console.log('TRACKLIST =', tracks);

        // 1) nađi engleski titl (en ili en-xxxx)
        var enTrack = null;
        if (tracks && tracks.length > 0) {
          enTrack = tracks.find(t => t.languageCode === 'en');
          if (!enTrack) {
            enTrack = tracks.find(t =>
              t.languageCode &&
              t.languageCode.toLowerCase().startsWith('en-')
            );
          }
        }

        console.log('Selected EN track =', enTrack);

        if (enTrack) {
          // uključi engleske titlove kao source
          player.setOption('captions', 'track', {
            languageCode: enTrack.languageCode
          });

          // traži auto-translate na srpski
          player.setOption('captions', 'translationLanguage', {
            languageCode: 'sr'
          });

          console.log('translationLanguage set to sr (serbian)');

          // proveri posle 5 sekundi šta je aktivno
          setTimeout(function () {
            var afterTrack = player.getOption('captions', 'track');
            console.log('AFTER TRANSLATION track =', afterTrack);
          }, 5000);

        } else {
          console.log('Nema engleskih titlova za ovaj video.');
        }
      } catch (e) {
        console.log('Error setting captions:', e);
      }
    }, 3000);
  }

  function onPlayerError(e) {
    console.log('onPlayerError:', e.data);
  }

  function onPlayerStateChange(e) {
    console.log('onPlayerStateChange:', e.data);
  }
</script>

</body>
</html>
