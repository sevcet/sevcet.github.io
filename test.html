<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>YouTube auto-translate to Slovak</title>
<script src="https://www.youtube.com/iframe_api"></script>
<style>
  html, body { margin: 0; padding: 0; height: 100%; background: #000; }
  #player { width: 100%; height: calc(100% - 80px); }
  #info {
    height: 80px;
    background: #111;
    color: #0f0;
    font-family: monospace;
    font-size: 13px;
    padding: 6px 10px;
    overflow-y: auto;
    box-sizing: border-box;
  }
</style>
</head>
<body>

<div id="player"></div>
<div id="info"></div>

<script>
  var player;

  function logInfo(msg, obj) {
    var p = document.getElementById('info');
    var line = document.createElement('div');
    line.textContent = msg + (obj ? ' ' + JSON.stringify(obj) : '');
    p.appendChild(line);
    p.scrollTop = p.scrollHeight;
    console.log(msg, obj || '');
  }

  function onYouTubeIframeAPIReady() {
    logInfo('onYouTubeIframeAPIReady');
    player = new YT.Player('player', {
      videoId: 'dQw4w9WgXcQ', // ili drugi video sa engleskim titlovima
      host: 'https://www.youtube.com',
      playerVars: {
        autoplay: 1,
        cc_load_policy: 1,
        controls: 1,
        rel: 0,
        modestbranding: 1
      },
      events: {
        onReady: onPlayerReady,
        onError: onPlayerError,
        onStateChange: onPlayerStateChange
      }
    });
  }

  function onPlayerReady() {
    logInfo('Player ready');

    try { player.playVideo(); } catch (e) { logInfo('playVideo error:', e); }

    setTimeout(function () {
      try {
        var tracks = player.getOption('captions', 'tracklist');
        logInfo('TRACKLIST =', tracks);

        // 1) pronađi engleski titl (en ili en-xxxx)
        var enTrack = null;
        if (tracks && tracks.length > 0) {
          enTrack = tracks.find(t => t.languageCode === 'en');
          if (!enTrack) {
            enTrack = tracks.find(t =>
              t.languageCode &&
              t.languageCode.toLowerCase().startsWith('en-')
            );
          }
        }

        logInfo('Selected EN track =', enTrack);

        if (enTrack) {
          // uključi engleske titlove kao source
          player.setOption('captions', 'track', {
            languageCode: enTrack.languageCode
          });
          logInfo('Set track to EN', enTrack.languageCode);

          // traži auto-translate na slovački
          player.setOption('captions', 'translationLanguage', {
            languageCode: 'sk'
          });
          logInfo('translationLanguage set to sk (slovak)');

          // proveri posle 5 sekundi šta je aktivno
          setTimeout(function () {
            var afterTrack = player.getOption('captions', 'track');
            logInfo('AFTER TRANSLATION track =', afterTrack);
          }, 5000);

        } else {
          logInfo('Nema engleskih titlova za ovaj video.');
        }
      } catch (e) {
        logInfo('Error setting captions:', e);
      }
    }, 3000);
  }

  function onPlayerError(e) {
    logInfo('onPlayerError: ' + e.data);
  }

  function onPlayerStateChange(e) {
    logInfo('onPlayerStateChange: ' + e.data);
  }
</script>

</body>
</html>
