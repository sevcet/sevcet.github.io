<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YouFlix Player v50 (Global CC + DPAD + Fallback)</title>

<style>
body, html {
    margin:0;
    padding:0;
    width:100%;
    height:100%;
    overflow:hidden;
    background:#000;
    font-family: Arial, sans-serif;
}

/* LOADING */
#loadingScreen {
    position:absolute; top:0; left:0;
    width:100%; height:100%;
    background:#000;
    display:flex; flex-direction:column;
    justify-content:center; align-items:center;
    z-index:9999; color:white;
}
.spinner {
    width:50px; height:50px;
    border:5px solid #333;
    border-top:5px solid #ff4444;
    border-radius:50%;
    animation:spin 1s linear infinite;
}
@keyframes spin {
    0% { transform:rotate(0);}
    100% { transform:rotate(360);}
}

/* EMPTY THUMBNAIL */
#customThumbnail {
    position:absolute;
    width:100%; height:100%;
    top:0; left:0;
    background:#000;
    opacity:0;
    display:none;
    z-index:9000;
}

/* ERROR SCREEN */
#errorScreen {
    position:absolute; top:0; left:0;
    width:100%; height:100%;
    background:#000; color:white;
    display:none; flex-direction:column;
    justify-content:center; align-items:center;
    z-index:10000;
}

/* PLAYER */
#playerContainer { width:100%; height:100%; }
#player { width:100%; height:100%; }

/* PROGRESS BAR */
#progressContainer {
    position:absolute; bottom:60px; left:5%;
    width:90%; height:6px;
    background:rgba(255,255,255,0.25);
    border-radius:3px;
    opacity:0;
    transition:0.3s;
    z-index:8000;
}
#progressBar {
    width:0%; height:100%;
    background:#ff4444;
    border-radius:3px;
}

/* INFO PANEL */
#infoPanel {
    position:absolute;
    top:30px; left:30px;
    padding:12px 18px;
    background:rgba(0,0,0,0.7);
    color:white;
    border-radius:8px;
    border-left:4px solid #ff4444;
    opacity:0;
    transition:0.3s;
    z-index:8000;
}

/* CC MENU */
#ccMenu {
    position:absolute;
    top:50%; left:50%;
    transform:translate(-50%,-50%);
    background:rgba(0,0,0,0.92);
    width:520px;
    max-height:620px;
    border-radius:12px;
    padding:20px;
    color:white;
    opacity:0;
    pointer-events:none;
    transition:0.3s;
    z-index:10001;
    display:flex;
    flex-direction:column;
}

#ccMenu.visible {
    opacity:1;
    pointer-events:all;
}

.cc-options-container {
    flex:1;
    overflow-y:auto;
    max-height:520px;
    padding-right:10px;
    scrollbar-width:thin;
}

.cc-option {
    padding:10px 15px;
    margin-bottom:4px;
    background:rgba(255,255,255,0.12);
    border-radius:6px;
    border:2px solid transparent;
    cursor:pointer;
}
.cc-option.selected {
    background:rgba(255,68,68,0.4);
    border-color:#ff4444;
}
.cc-option:hover {
    background:rgba(255,255,255,0.25);
}
</style>
</head>

<body>

<!-- LOADING -->
<div id="loadingScreen">
    <div class="spinner"></div>
    <div style="margin-top:20px;">Loading YouTube player...</div>
</div>

<!-- EMPTY THUMBNAIL -->
<div id="customThumbnail"></div>

<!-- ERROR -->
<div id="errorScreen">
    <div id="errorText">YouTube error</div>
    <button onclick="location.reload()" style="
        margin-top:20px; padding:12px 28px;
        background:#ff4444; color:white;
        border:none; border-radius:8px;">
        TRY AGAIN
    </button>
</div>

<!-- PLAYER -->
<div id="playerContainer">
    <div id="player"></div>
</div>

<!-- PROGRESS -->
<div id="progressContainer">
    <div id="progressBar"></div>
</div>

<!-- CC MENU -->
<div id="ccMenu">
    <div style="font-size:22px; text-align:center; margin-bottom:10px; color:#ff4444;">
        Subtitle language
    </div>

    <div id="ccOptions" class="cc-options-container">

        <!-- NO SUBTITLES -->
        <div class="cc-option selected" data-language="off">âŒ Off</div>

        <!-- 43 LANGUAGES -->
        <div class="cc-option" data-language="en">English ğŸ‡ºğŸ‡¸</div>
        <div class="cc-option" data-language="fr">FranÃ§ais ğŸ‡«ğŸ‡·</div>
        <div class="cc-option" data-language="de">Deutsch ğŸ‡©ğŸ‡ª</div>
        <div class="cc-option" data-language="es">EspaÃ±ol ğŸ‡ªğŸ‡¸</div>
        <div class="cc-option" data-language="it">Italiano ğŸ‡®ğŸ‡¹</div>
        <div class="cc-option" data-language="pt">PortuguÃªs ğŸ‡µğŸ‡¹</div>

        <div class="cc-option" data-language="nl">Nederlands ğŸ‡³ğŸ‡±</div>
        <div class="cc-option" data-language="pl">Polski ğŸ‡µğŸ‡±</div>
        <div class="cc-option" data-language="cs">ÄŒeÅ¡tina ğŸ‡¨ğŸ‡¿</div>
        <div class="cc-option" data-language="sk">SlovenÄina ğŸ‡¸ğŸ‡°</div>
        <div class="cc-option" data-language="sl">SlovenÅ¡Äina ğŸ‡¸ğŸ‡®</div>

        <div class="cc-option" data-language="hr">Hrvatski ğŸ‡­ğŸ‡·</div>
        <div class="cc-option" data-language="bs">Bosanski ğŸ‡§ğŸ‡¦</div>
        <div class="cc-option" data-language="sr">Srpski ğŸ‡·ğŸ‡¸</div>
        <div class="cc-option" data-language="mk">ĞœĞ°ĞºĞµĞ´Ğ¾Ğ½ÑĞºĞ¸ ğŸ‡²ğŸ‡°</div>
        <div class="cc-option" data-language="sq">Shqip ğŸ‡¦ğŸ‡±</div>

        <div class="cc-option" data-language="bg">Ğ‘ÑŠĞ»Ğ³Ğ°Ñ€ÑĞºĞ¸ ğŸ‡§ğŸ‡¬</div>
        <div class="cc-option" data-language="ro">RomÃ¢nÄƒ ğŸ‡·ğŸ‡´</div>
        <div class="cc-option" data-language="hu">Magyar ğŸ‡­ğŸ‡º</div>
        <div class="cc-option" data-language="tr">TÃ¼rkÃ§e ğŸ‡¹ğŸ‡·</div>
        <div class="cc-option" data-language="el">Î•Î»Î»Î·Î½Î¹ÎºÎ¬ ğŸ‡¬ğŸ‡·</div>

        <div class="cc-option" data-language="da">Dansk ğŸ‡©ğŸ‡°</div>
        <div class="cc-option" data-language="sv">Svenska ğŸ‡¸ğŸ‡ª</div>
        <div class="cc-option" data-language="fi">Suomi ğŸ‡«ğŸ‡®</div>
        <div class="cc-option" data-language="no">Norsk ğŸ‡³ğŸ‡´</div>
        <div class="cc-option" data-language="is">Ãslenska ğŸ‡®ğŸ‡¸</div>

        <div class="cc-option" data-language="et">Eesti ğŸ‡ªğŸ‡ª</div>
        <div class="cc-option" data-language="lv">LatvieÅ¡u ğŸ‡±ğŸ‡»</div>
        <div class="cc-option" data-language="lt">LietuviÅ³ ğŸ‡±ğŸ‡¹</div>

        <div class="cc-option" data-language="uk">Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ° ğŸ‡ºğŸ‡¦</div>
        <div class="cc-option" data-language="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹ ğŸ‡·ğŸ‡º</div>

        <div class="cc-option" data-language="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ğŸ‡¸ğŸ‡¦</div>
        <div class="cc-option" data-language="fa">ÙØ§Ø±Ø³ÛŒ ğŸ‡®ğŸ‡·</div>
        <div class="cc-option" data-language="hi">à¤¹à¤¿à¤¨à¥à¤¦à¥€ ğŸ‡®ğŸ‡³</div>
        <div class="cc-option" data-language="bn">à¦¬à¦¾à¦‚à¦²à¦¾ ğŸ‡§ğŸ‡©</div>

        <div class="cc-option" data-language="zh">ä¸­æ–‡ ğŸ‡¨ğŸ‡³</div>
        <div class="cc-option" data-language="ja">æ—¥æœ¬èª ğŸ‡¯ğŸ‡µ</div>
        <div class="cc-option" data-language="ko">í•œêµ­ì–´ ğŸ‡°ğŸ‡·</div>

        <div class="cc-option" data-language="vi">Tiáº¿ng Viá»‡t ğŸ‡»ğŸ‡³</div>
        <div class="cc-option" data-language="id">Bahasa Indonesia ğŸ‡®ğŸ‡©</div>
        <div class="cc-option" data-language="ms">Bahasa Melayu ğŸ‡²ğŸ‡¾</div>
        <div class="cc-option" data-language="th">à¹„à¸—à¸¢ ğŸ‡¹ğŸ‡­</div>

    </div>
</div>

<div id="infoPanel"></div>

<script src="https://www.youtube.com/iframe_api"></script>

<script>
/* CORE VARS */
let player;
let isPlaying=false;
let isCCMenuOpen=false;
let currentCCSelection=0;
let hideTimeout=null;
let progressInterval=null;

/* INIT */
function onYouTubeIframeAPIReady(){ initPlayer(); }

function initPlayer(){

    const params=new URLSearchParams(location.search);
    const videoId=params.get("videoId");
    const autoLang=params.get("lang");

    player=new YT.Player("player",{
        videoId:videoId,
        width:"100%", height:"100%",
        playerVars:{
            autoplay:1, controls:0, fs:1,
            rel:0, modestbranding:1,
            iv_load_policy:3, disablekb:1
        },
        events:{
            onReady:()=>onPlayerReady(autoLang),
            onStateChange:onPlayerStateChange,
            onError:showError
        }
    });
}

function onPlayerReady(autoLang){
    document.getElementById("loadingScreen").style.display="none";

    if (autoLang) {
        setTimeout(() => {
            autoSelectLanguage(autoLang);
            selectCC();   // odmah ukljuÄi titl koji je izabrao korisnik
        }, 500);
    }

    startProgress();
}

/* AUTO SELECT CC BASED ON ANDROID SETTINGS */
function autoSelectLanguage(lang){

    const options=document.querySelectorAll(".cc-option");
    let found=false;

    options.forEach((o,i)=>{
        if(o.dataset.language===lang){
            currentCCSelection=i;
            found=true;
        }
    });

    if(!found) currentCCSelection=0;

    selectCC();
}

/* DPAD + CC MENU */
document.addEventListener("keydown", e=>{
    
    const opts=document.querySelectorAll(".cc-option");

    switch(e.key){

        case "ArrowUp":
            if(isCCMenuOpen){
                currentCCSelection--;
                if(currentCCSelection<0) currentCCSelection=opts.length-1;
                updateCCMenu();
                opts[currentCCSelection].scrollIntoView({block:"center"});
            } else {
                openCCMenu();
            }
            e.preventDefault();
            break;

        case "ArrowDown":
            if(isCCMenuOpen){
                currentCCSelection++;
                if(currentCCSelection>=opts.length) currentCCSelection=0;
                updateCCMenu();
                opts[currentCCSelection].scrollIntoView({block:"center"});
            }
            e.preventDefault();
            break;

        case "Enter":
            if(isCCMenuOpen){
                selectCC();
                closeCCMenu();
            } else {
                togglePlay();
            }
            e.preventDefault();
            break;

        case " ":
            if(!isCCMenuOpen) togglePlay();
            e.preventDefault();
            break;

        case "ArrowLeft":
            if(!isCCMenuOpen){
                player.seekTo(player.getCurrentTime()-60, true);
            }
            e.preventDefault();
            break;

        case "ArrowRight":
            if(!isCCMenuOpen){
                player.seekTo(player.getCurrentTime()+60, true);
            }
            e.preventDefault();
            break;

        case "Backspace":
        case "Escape":
            if(isCCMenuOpen) closeCCMenu();
            else history.back();
            e.preventDefault();
            break;
    }
});

/* CC MENU CONTROL */
function openCCMenu(){
    isCCMenuOpen=true;
    document.getElementById("ccMenu").classList.add("visible");
    updateCCMenu();
}
function closeCCMenu(){
    isCCMenuOpen=false;
    document.getElementById("ccMenu").classList.remove("visible");
}
function updateCCMenu(){
    document.querySelectorAll(".cc-option").forEach((o,i)=>{
        o.classList.toggle("selected", i===currentCCSelection);
    });
}
function selectCC(){
    const lang=document.querySelectorAll(".cc-option")[currentCCSelection].dataset.language;

    try {
        if(lang==="off"){
            player.setOption("captions","track",{});
            player.unloadModule("captions");
        } else {
            player.loadModule("captions");
            setTimeout(()=>{
                player.setOption("captions","track",{languageCode:lang});
            },150);
        }
    } catch(e){}
}

/* PLAY/PAUSE */
function togglePlay(){
    if(isPlaying) player.pauseVideo();
    else player.playVideo();
}

function onPlayerStateChange(e){
    isPlaying = (e.data===1);
}

/* PROGRESS BAR */
function startProgress(){
    progressInterval=setInterval(()=>{
        if(player && player.getDuration){
            let c=player.getCurrentTime();
            let d=player.getDuration();
            document.getElementById("progressBar").style.width = (c/d*100)+"%";
        }
    },800);
}

/* ERROR */
function showError(e){
    document.getElementById("errorText").textContent="YouTube error: "+e.data;
    document.getElementById("errorScreen").style.display="flex";
}

</script>

</body>
</html>
