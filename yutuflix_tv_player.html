<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Player</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            background: #000;
            overflow: hidden;
            width: 100%;
            height: 100%;
            touch-action: manipulation;
        }
        #player {
            width: 100%;
            height: 100%;
            border: none;
        }
        #closeBtn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: #fff;
            border: none;
            font-size: 24px;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            z-index: 10000;
            transition: opacity 0.3s, background 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
            font-weight: bold;
        }
        #closeBtn:hover {
            background: rgba(255,0,0,0.9);
            transform: translateY(-50%) scale(1.1);
        }
        #closeBtn:active {
            transform: translateY(-50%) scale(0.95);
        }
    </style>
</head>
<body>
<button id="closeBtn" title="Zatvori">✕</button>

<div id="player"></div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
    let player;
    let hideTimeout;

    function onYouTubeIframeAPIReady() {
        const urlParams = new URLSearchParams(window.location.search);
        const videoId = urlParams.get('videoId');

        player = new YT.Player('player', {
            height: '100%',
            width: '100%',
            videoId: videoId,
            playerVars: {
                autoplay: 1,
                rel: 0,
                modestbranding: 1,
                controls: 1,
                showinfo: 1,
                fs: 1,
                iv_load_policy: 3,
                disablekb: 0,
                playsinline: 1,

                // >>> TITLOVI
                cc_load_policy: 1,      // uvek uključi CC ako postoje
                cc_lang_pref: 'en'      // ili stavi 'sr', 'de'... ili izbaci da bira po korisniku
            },
            events: {
                onReady: onPlayerReady,
                onStateChange: onPlayerStateChange,
                onApiChange: onPlayerApiChange   // dodat event
            }
        });
    }

    // čim se API promijeni, još jednom forsiraj titlove (radi i za auto‑generated) [web:211]
    function onPlayerApiChange() {
        try {
            if (player && typeof player.setOption === 'function') {
                player.setOption('captions', 'track', { languageCode: 'en' });
            }
        } catch (e) {
            console.log('CC setOption error', e);
        }
    }

    function onPlayerReady(event) {
        event.target.playVideo();
        hideTimeout = setTimeout(hideCloseButton, 10000);
    }

    function onPlayerStateChange(event) {
        resetHideTimer();
    }

    function hideCloseButton() {
        const closeBtn = document.getElementById('closeBtn');
        if (closeBtn) {
            closeBtn.style.opacity = '0';
        }
    }

    function showCloseButton() {
        const closeBtn = document.getElementById('closeBtn');
        if (closeBtn) {
            closeBtn.style.opacity = '1';
            resetHideTimer();
        }
    }

    function resetHideTimer() {
        clearTimeout(hideTimeout);
        hideTimeout = setTimeout(hideCloseButton, 10000);
    }

    document.addEventListener('click', function(event) {
        if (event.target.id !== 'closeBtn') {
            showCloseButton();
        }
    });

    document.getElementById('closeBtn').addEventListener('click', function() {
        if (window.AndroidInterface) {
            AndroidInterface.closePlayer();
        } else {
            window.history.back();
        }
    });

    document.addEventListener('mousemove', function() {
        showCloseButton();
    });

    document.addEventListener('touchstart', function() {
        showCloseButton();
    });

    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            if (window.AndroidInterface) {
                AndroidInterface.closePlayer();
            }
        }
    });

    window.addEventListener('load', function() {
        setTimeout(hideCloseButton, 10000);
    });
</script>
</body>
</html>
