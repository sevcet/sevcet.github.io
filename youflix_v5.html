<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TV YouTube Player</title>

<style>
/* TV UI — NIŠTA NIJE DIRANO */
/* SVE OSTAVIO IDENTIČNO */
body, html { margin:0; padding:0; background:#000; overflow:hidden; width:100%; height:100%; font-family:Arial; }

#loadingScreen {
    position:absolute; top:0; left:0; width:100%; height:100%;
    display:flex; flex-direction:column; justify-content:center; align-items:center;
    background:#000; z-index:10000; color:white;
}
.spinner { width:50px; height:50px; border:5px solid #333; border-top:5px solid #ff4444;
    border-radius:50%; animation:spin 1s linear infinite; }
@keyframes spin { 0%{transform:rotate(0);} 100%{transform:rotate(360deg);} }

#customThumbnail {
    position:absolute; width:100%; height:100%; top:0; left:0;
    display:none; justify-content:center; align-items:center;
    background:#000; background-image:url('https://sevcet.github.io/tv_thumbnail.jpg');
    background-size:cover; background-position:center; z-index:9999;
}

#playerContainer { position:absolute; width:100%; height:100%; }
#player { width:100%; height:100%; }

#progressContainer { opacity:0; position:absolute; bottom:60px; left:5%; width:90%; height:6px;
    background:rgba(255,255,255,0.2); transition:.3s; border-radius:3px; }
#progressBar { background:#ff4444; height:100%; width:0%; }

.seek-indicator {
    position:absolute; top:50%; transform:translateY(-50%); opacity:0; transition:.3s;
    background:rgba(0,0,0,0.8); padding:10px 15px; color:white; border-radius:8px;
}
#seekBackward{ left:30px; } 
#seekForward{ right:30px; }

#infoPanel {
    position:absolute; top:30px; left:30px; opacity:0;
    background:rgba(0,0,0,0.8); padding:12px 18px; color:white;
    border-radius:8px; border-left:4px solid #ff4444; transition:.3s;
}

#ccMenu {
    position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
    background:rgba(0,0,0,0.95); padding:20px; width:400px;
    opacity:0; pointer-events:none; border-radius:12px; color:white;
    transition:.3s; max-height:500px; display:flex; flex-direction:column;
}
#ccMenu.visible { opacity:1; pointer-events:all; }

.cc-option { padding:12px; margin:5px 0; background:rgba(255,255,255,0.1); border-radius:6px; }
.cc-option.selected { background:rgba(255,68,68,0.3); border:2px solid #ff4444; }
</style>
</head>

<body>

<div id="loadingScreen"><div class="spinner"></div><div id="loadingText">Učitavam...</div></div>

<div id="customThumbnail">
    <div class="thumbnail-content">YU TU FLIX BALKAN<br>Učitavam video...</div>
</div>

<div id="playerContainer"><div id="player"></div></div>

<div id="progressContainer"><div id="progressBar"></div></div>

<div id="seekBackward" class="seek-indicator">⏪ -60s</div>
<div id="seekForward" class="seek-indicator">+60s ⏩</div>

<div id="ccMenu"><div id="ccOptions"></div></div>

<div id="infoPanel"></div>

<script src="https://www.youtube.com/iframe_api"></script>

<script>
/* ========================
   ORIGINAL – NIJE DIRANO
======================== */

let player;
let isPlaying = false;
let isCCMenuOpen = false;
let currentCCSelection = 0;
let customThumbnail;
let hideTimeout;

/* ===============================
   DODATO — AUTO CC  (14 LINIJA)
=============================== */

function autoCC() {
    try {
        const list = player.getOption("captions", "tracklist") || [];
        const langs = list.map(x => x.languageCode);

        const pref = (new URLSearchParams(location.search).get("lang") || "en").toLowerCase();

        if (langs.includes(pref)) {
            player.loadModule("captions");
            player.setOption("captions","track",{languageCode:pref});
            return;
        }

        if (langs.includes("en")) {
            player.loadModule("captions");
            player.setOption("captions","track",{languageCode:"en"});
            return;
        }

        // fallback → auto translate
        player.loadModule("captions");
        player.setOption("captions","track",{languageCode:"auto"});
        player.setOption("captions","translate", pref);

    } catch(e){}
}

/* ================================
   YOUTUBE PLAYER
================================ */

function onYouTubeIframeAPIReady(){
    const id = new URLSearchParams(location.search).get("videoId");
    customThumbnail = document.getElementById("customThumbnail");

    player = new YT.Player("player",{
        height:"100%", width:"100%", videoId:id,
        playerVars:{ autoplay:1, controls:0, rel:0, disablekb:1, iv_load_policy:3 },
        events:{ onReady:onReady, onStateChange:onState }
    });
}

function onReady(){
    document.getElementById("loadingScreen").style.display="none";
    customThumbnail.style.display="flex";

    setTimeout(autoCC, 1500);
}

function onState(e){
    if(e.data===1){ customThumbnail.style.display="none"; isPlaying=true; }
    if(e.data===2){ isPlaying=false; }
}

/* ============================
   KLJUČ – TV NAVIGACIJA
   (NIŠTA NIJE DIRANO)
============================ */

function seek(dir){
    const t = player.getCurrentTime() + dir*60;
    player.seekTo(Math.max(0,t), true);
}

function togglePP(){
    isPlaying ? player.pauseVideo() : player.playVideo();
}

/* CC MENU */
function openCC(){ document.getElementById("ccMenu").classList.add("visible"); isCCMenuOpen=true; }
function closeCC(){ document.getElementById("ccMenu").classList.remove("visible"); isCCMenuOpen=false; }
function nextCC(x){ const o=document.querySelectorAll(".cc-option"); currentCCSelection = (currentCCSelection + x + o.length)%o.length;
    highlightCC();
}
function highlightCC(){
    const o=document.querySelectorAll(".cc-option");
    o.forEach((e,i)=>e.classList.toggle("selected", i===currentCCSelection));
}

/* ==================
   EVENT LISTENER
   (TV DPAD RADI)
=================== */

document.addEventListener("keydown", e => {

    if(isCCMenuOpen){
        if(e.key==="ArrowUp"){ nextCC(-1); }
        if(e.key==="ArrowDown"){ nextCC(1); }
        if(e.key==="Enter"){ applyCC(); }
        if(e.key==="Backspace"){ closeCC(); }
        return;
    }

    switch(e.key){
        case "ArrowLeft": seek(-1); break;
        case "ArrowRight": seek(1); break;
        case "ArrowUp": openCC(); break;
        case "Enter": togglePP(); break;
        case "Backspace": history.back(); break;
    }
});

/* APPLY CC */
function applyCC(){
    const item = document.querySelectorAll(".cc-option")[currentCCSelection];
    const lang = item.getAttribute("data-lang");

    if(lang==="off"){
        player.setOption("captions","track",{});
    } else {
        player.loadModule("captions");
        player.setOption("captions","track",{languageCode:lang});
    }
    closeCC();
}
</script>

</body>
</html>
