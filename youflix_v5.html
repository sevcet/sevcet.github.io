<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YouFlix Player v42</title>

<style>
body, html {
    margin: 0;
    padding: 0;
    background: #000;
    overflow: hidden;
    width: 100%;
    height: 100%;
    font-family: Arial, sans-serif;
}

/* Loading */
#loadingScreen {
    position: absolute; top: 0; left: 0;
    width: 100%; height: 100%;
    background: #000;
    display: flex; flex-direction: column;
    justify-content: center; align-items: center;
    z-index: 10000; color: white;
}
.spinner {
    width: 50px; height: 50px;
    border: 5px solid #333;
    border-top: 5px solid #ff4444;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}
@keyframes spin { 0%{transform:rotate(0);} 100%{transform:rotate(360deg);} }

/* Thumbnail (prazan â€“ stabilizuje reklame) */
#customThumbnail {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    display: none;
    background: #000;
    opacity: 0;
    z-index: 9998;
}

/* Error screen */
#errorScreen {
    position:absolute; top:0; left:0;
    width:100%; height:100%;
    background:#000; color:white;
    display:none; flex-direction:column;
    justify-content:center; align-items:center;
    z-index:10000; text-align:center;
}

/* Player */
#playerContainer {
    width:100%; height:100%; position:relative;
}
#player {
    width:100%; height:100%;
}

/* Progress bar */
#progressContainer {
    position:absolute; bottom:60px; left:5%;
    width:90%; height:6px;
    border-radius:3px;
    background:rgba(255,255,255,0.2);
    opacity:0; transition:0.3s;
}
#progressBar {
    width:0%; height:100%; border-radius:3px;
    background:#ff4444;
}

/* Info panel */
#infoPanel {
    position:absolute; top:30px; left:30px;
    padding:12px 18px;
    background:rgba(0,0,0,0.75);
    color:white; border-radius:8px;
    border-left:4px solid #ff4444;
    opacity:0; transition:0.3s;
    font-size:16px;
}

/* CC MENU */
#ccMenu {
    position:absolute; top:50%; left:50%;
    transform:translate(-50%, -50%);
    background:rgba(0,0,0,0.95);
    width:500px; max-height:600px;
    border-radius:12px;
    padding:20px; color:white;
    opacity:0; transition:opacity .3s;
    pointer-events:none; z-index:10002;
    display:flex; flex-direction:column;
}
#ccMenu.visible { opacity:1; pointer-events:all; }

.cc-options-container {
    flex:1; overflow-y:auto; max-height:480px;
    padding-right:10px;
}
.cc-option {
    padding:10px 15px; margin:4px 0;
    background:rgba(255,255,255,0.1);
    border-radius:6px; cursor:pointer;
    border:2px solid transparent;
}
.cc-option.selected {
    background:rgba(255,68,68,0.4);
    border-color:#ff4444;
}
.cc-option:hover {
    background:rgba(255,255,255,0.2);
}

</style>
</head>

<body>

<!-- Loading -->
<div id="loadingScreen">
    <div class="spinner"></div>
    <div style="margin-top:20px;">UÄitavam YouTube player...</div>
</div>

<!-- Thumbnail -->
<div id="customThumbnail"></div>

<!-- Error -->
<div id="errorScreen">
    <div id="errorText">GreÅ¡ka pri uÄitavanju playera</div>
    <button onclick="retryPlayer()" style="
        margin-top:20px; padding:12px 24px;
        background:#ff4444; color:white; border:none; border-radius:8px;">
        POKUÅ AJ PONOVO
    </button>
</div>

<!-- Player -->
<div id="playerContainer"><div id="player"></div></div>

<!-- Progress -->
<div id="progressContainer"><div id="progressBar"></div></div>

<!-- CC MENU -->
<div id="ccMenu">
    <div style="font-size:20px;text-align:center;color:#ff4444;margin-bottom:10px;">
        Odabir titlova
    </div>

    <div id="ccOptions" class="cc-options-container">

        <!-- OFF -->
        <div class="cc-option selected" data-language="off">âŒ Bez titlova</div>

        <!-- 42 JEZIKA -->
        <div class="cc-option" data-language="en">ğŸ‡ºğŸ‡¸ English</div>
        <div class="cc-option" data-language="fr">ğŸ‡«ğŸ‡· FranÃ§ais</div>
        <div class="cc-option" data-language="de">ğŸ‡©ğŸ‡ª Deutsch</div>
        <div class="cc-option" data-language="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</div>
        <div class="cc-option" data-language="it">ğŸ‡®ğŸ‡¹ Italiano</div>
        <div class="cc-option" data-language="pt">ğŸ‡µğŸ‡¹ PortuguÃªs</div>

        <div class="cc-option" data-language="nl">ğŸ‡³ğŸ‡± Nederlands</div>
        <div class="cc-option" data-language="pl">ğŸ‡µğŸ‡± Polski</div>
        <div class="cc-option" data-language="cs">ğŸ‡¨ğŸ‡¿ ÄŒeÅ¡tina</div>
        <div class="cc-option" data-language="sk">ğŸ‡¸ğŸ‡° SlovenÄina</div>
        <div class="cc-option" data-language="sl">ğŸ‡¸ğŸ‡® SlovenÅ¡Äina</div>

        <div class="cc-option" data-language="hr">ğŸ‡­ğŸ‡· Hrvatski</div>
        <div class="cc-option" data-language="bs">ğŸ‡§ğŸ‡¦ Bosanski</div>
        <div class="cc-option" data-language="sr">ğŸ‡·ğŸ‡¸ Srpski</div>

        <div class="cc-option" data-language="mk">ğŸ‡²ğŸ‡° ĞœĞ°ĞºĞµĞ´Ğ¾Ğ½ÑĞºĞ¸</div>
        <div class="cc-option" data-language="sq">ğŸ‡¦ğŸ‡± Shqip</div>

        <div class="cc-option" data-language="bg">ğŸ‡§ğŸ‡¬ Ğ‘ÑŠĞ»Ğ³Ğ°Ñ€ÑĞºĞ¸</div>
        <div class="cc-option" data-language="ro">ğŸ‡·ğŸ‡´ RomÃ¢nÄƒ</div>
        <div class="cc-option" data-language="hu">ğŸ‡­ğŸ‡º Magyar</div>
        <div class="cc-option" data-language="tr">ğŸ‡¹ğŸ‡· TÃ¼rkÃ§e</div>
        <div class="cc-option" data-language="el">ğŸ‡¬ğŸ‡· Î•Î»Î»Î·Î½Î¹ÎºÎ¬</div>

        <div class="cc-option" data-language="da">ğŸ‡©ğŸ‡° Dansk</div>
        <div class="cc-option" data-language="sv">ğŸ‡¸ğŸ‡ª Svenska</div>
        <div class="cc-option" data-language="fi">ğŸ‡«ğŸ‡® Suomi</div>
        <div class="cc-option" data-language="no">ğŸ‡³ğŸ‡´ Norsk</div>
        <div class="cc-option" data-language="is">ğŸ‡®ğŸ‡¸ Ãslenska</div>

        <div class="cc-option" data-language="et">ğŸ‡ªğŸ‡ª Eesti</div>
        <div class="cc-option" data-language="lv">ğŸ‡±ğŸ‡» LatvieÅ¡u</div>
        <div class="cc-option" data-language="lt">ğŸ‡±ğŸ‡¹ LietuviÅ³</div>

        <div class="cc-option" data-language="uk">ğŸ‡ºğŸ‡¦ Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°</div>
        <div class="cc-option" data-language="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</div>

        <div class="cc-option" data-language="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</div>
        <div class="cc-option" data-language="fa">ğŸ‡®ğŸ‡· ÙØ§Ø±Ø³ÛŒ</div>
        <div class="cc-option" data-language="hi">ğŸ‡®ğŸ‡³ à¤¹à¤¿à¤‚à¤¦à¥€</div>
        <div class="cc-option" data-language="bn">ğŸ‡§ğŸ‡© à¦¬à¦¾à¦‚à¦²à¦¾</div>

        <div class="cc-option" data-language="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</div>
        <div class="cc-option" data-language="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</div>
        <div class="cc-option" data-language="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</div>

        <div class="cc-option" data-language="vi">ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t</div>
        <div class="cc-option" data-language="id">ğŸ‡®ğŸ‡© Bahasa Indonesia</div>
        <div class="cc-option" data-language="ms">ğŸ‡²ğŸ‡¾ Bahasa Melayu</div>
        <div class="cc-option" data-language="th">ğŸ‡¹ğŸ‡­ à¹„à¸—à¸¢</div>

    </div>
</div>

<div id="infoPanel"></div>

<script src="https://www.youtube.com/iframe_api"></script>

<script>
/* ======= Originalna logika â€” NIÅ TA NIJE DIRANO osim auto-CC ======= */
let player, hideTimeout, isPlaying=false, isCCMenuOpen=false;
let currentCCSelection=0, progressInterval, customThumbnail;
let stateCheckInterval, hasAdStarted=false, hasVideoStarted=false;

function onYouTubeIframeAPIReady(){ initializePlayer(); }

function initializePlayer(){
    const p = new URLSearchParams(window.location.search);
    const videoId = p.get("videoId");
    const autoLang = p.get("lang");

    customThumbnail=document.getElementById("customThumbnail");

    player=new YT.Player("player",{
        height:"100%", width:"100%", videoId:videoId,
        playerVars:{
            autoplay:1, rel:0, modestbranding:1,
            controls:0, showinfo:0, fs:1,
            iv_load_policy:3, disablekb:1,
            playsinline:1, cc_load_policy:0,
            enablejsapi:1
        },
        events:{
            onReady:e=>onReady(e,autoLang),
            onStateChange:onPlayerStateChange,
            onError:onError
        }
    });
}

function onReady(e,autoLang){
    document.getElementById("loadingScreen").style.display="none";
    showCustomThumbnail();

    if(autoLang) autoSelectSubtitles(autoLang);

    hideControls();
    startAdDetection();
}

/* ===================
   AUTO CC 42 JEZIKA
   =================== */
function autoSelectSubtitles(lang){

    const map = {
        "en":"en","fr":"fr","de":"de","es":"es","it":"it","pt":"pt",
        "nl":"nl","pl":"pl","cs":"cs","sk":"sk","sl":"sl",
        "hr":"hr","bs":"bs","sr":"sr",
        "mk":"mk","sq":"sq",
        "bg":"bg","ro":"ro","hu":"hu","tr":"tr","el":"el",
        "da":"da","sv":"sv","fi":"fi","no":"no","is":"is",
        "et":"et","lv":"lv","lt":"lt",
        "uk":"uk","ru":"ru",
        "ar":"ar","fa":"fa","hi":"hi","bn":"bn",
        "zh":"zh","ja":"ja","ko":"ko",
        "vi":"vi","id":"id","ms":"ms","th":"th"
    };

    const target = map[lang] || "off";

    const opts=document.querySelectorAll(".cc-option");
    let found=false;

    opts.forEach((o,i)=>{
        if(o.getAttribute("data-language")===target){
            currentCCSelection=i;
            found=true;
        }
    });

    if(!found) currentCCSelection=0; // OFF

    selectCCOption();
}

/* ================================ */
/* OSTATAK KODA â€” NIJE MENJAN */
/* ================================ */

function onPlayerStateChange(e){
    if(e.data===1){ hideCustomThumbnail(); isPlaying=true; startProgressTracking(); }
    if(e.data===2){ isPlaying=false; stopProgressTracking(); }
}

function onError(e){ showError("YouTube greÅ¡ka: "+e.data); }

function showCustomThumbnail(){ customThumbnail.style.display="flex"; }
function hideCustomThumbnail(){ customThumbnail.style.display="none"; }

function startProgressTracking(){
    stopProgressTracking();
    progressInterval=setInterval(()=>{
        if(player && player.getDuration){
            const c=player.getCurrentTime();
            const d=player.getDuration();
            document.getElementById("progressBar").style.width=((c/d)*100)+"%";
        }
    },1000);
}
function stopProgressTracking(){
    if(progressInterval) clearInterval(progressInterval);
}

/* CC SELECT */
function selectCCOption(){
    const opts=document.querySelectorAll(".cc-option");
    const lang=opts[currentCCSelection].getAttribute("data-language");

    try{
        if(lang==="off"){
            player.setOption("captions","track",{});
            player.unloadModule("captions");
        } else {
            player.loadModule("captions");
            setTimeout(()=>player.setOption(
                "captions","track",{languageCode:lang}),150);
        }
    }catch(e){}
}

/* UI */
function hideControls(){
    document.getElementById("progressContainer").style.opacity=0;
}
function retryPlayer(){ location.reload(); }

document.addEventListener("keydown",e=>{
    switch(e.key){
        case "ArrowUp": document.getElementById("ccMenu").classList.add("visible"); break;
        case "ArrowDown": currentCCSelection++; break;
        case "Enter": selectCCOption(); document.getElementById("ccMenu").classList.remove("visible"); break;
        case "ArrowLeft": player.seekTo(player.getCurrentTime()-60,true); break;
        case "ArrowRight": player.seekTo(player.getCurrentTime()+60,true); break;
        case "Backspace":
        case "Escape": history.back(); break;
    }
});
</script>

</body>
</html>
