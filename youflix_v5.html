<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YouFlix Player v8 (Stable)</title>

<style>
    body, html {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        background: #000;
        overflow: hidden;
        font-family: Arial, sans-serif;
    }

    #loadingScreen {
        position: absolute;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: #000;
        color: #fff;
        display: flex; flex-direction: column;
        justify-content: center; align-items: center;
        z-index: 99999;
    }

    .spinner {
        width: 50px; height: 50px;
        border: 5px solid #333;
        border-top: 5px solid #ff4444;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin { 0%{transform:rotate(0);} 100%{transform:rotate(360deg);} }

    #customThumbnail {
        position: absolute; top: 0; left: 0;
        width: 100%; height: 100%;
        background-image: url('https://sevcet.github.io/tv_thumbnail.jpg');
        background-size: cover;
        background-position: center;
        z-index: 9000;
        display: none;
        justify-content: center;
        align-items: center;
    }

    #player { width:100%; height:100%; }

    #infoPanel {
        position:absolute; top:30px; left:30px;
        padding:12px 18px;
        background:rgba(0,0,0,0.7);
        border-left:4px solid #ff4444;
        color:white;
        font-size:16px;
        border-radius:8px;
        opacity:0;
        transition:opacity .3s;
        z-index:9999;
    }
</style>
</head>

<body>

<div id="loadingScreen">
    <div class="spinner"></div>
    <div style="margin-top:20px;">Učitavam YouTube player…</div>
</div>

<div id="customThumbnail">
    <div style="background:rgba(0,0,0,0.7); padding:40px; border-radius:20px; color:white;">
        YouFlix Balkan<br>Učitavam video...
    </div>
</div>

<div id="player"></div>

<div id="infoPanel"></div>

<script src="https://www.youtube.com/iframe_api"></script>

<script>
let player;
let isPlaying = false;

/* AUTO CC PRIORITET LISTA + FALLBACK */
function autoSelectCC() {
    try {
        let tracks = player.getOption("captions", "tracklist") || [];
        let list = tracks.map(t => t.languageCode);

        const userLang = (new URLSearchParams(location.search).get("lang") || "en").toLowerCase();

        let pick = null;

        // PRIORITET:
        // 1) user language
        if (list.includes(userLang)) pick = userLang;

        // 2) fallback: English
        if (!pick && list.includes("en")) pick = "en";

        if (pick) {
            player.loadModule("captions");
            player.setOption("captions", "track", { languageCode: pick });
            showInfo("Titl: " + pick.toUpperCase());
            return;
        }

        // 3) AUTO TRANSLATE ako nema nijedan titl
        player.loadModule("captions");
        setTimeout(() => {
            player.setOption("captions", "track", { languageCode:"auto" });
            player.setOption("captions", "translate", userLang);
            showInfo("Auto-Translate → " + userLang.toUpperCase());
        }, 500);

    } catch(e){}
}

/* YT API */
function onYouTubeIframeAPIReady() {
    const id = new URLSearchParams(location.search).get("videoId");

    player = new YT.Player("player", {
        width: "100%", height: "100%",
        videoId: id,
        playerVars:{
            autoplay:1, controls:0, rel:0,
            fs:1, disablekb:1, modestbranding:1,
            iv_load_policy:3
        },
        events:{
            onReady:onReady,
            onStateChange:onState
        }
    });
}

function onReady() {
    document.getElementById("loadingScreen").style.display = "none";
    showThumbnail();

    // AUTO CC posle starta
    setTimeout(autoSelectCC, 1500);

    showInfo("←→ 60s | ENTER pauza/play | BACK izlaz");
}

function onState(e) {
    if (e.data === YT.PlayerState.PLAYING) {
        hideThumbnail();
        isPlaying = true;
    }
    if (e.data === YT.PlayerState.PAUSED) {
        isPlaying = false;
    }
}

/* THUMBNAIL */
function showThumbnail(){ customThumbnail.style.display="flex"; }
function hideThumbnail(){ customThumbnail.style.display="none"; }

/* INFO */
function showInfo(t){
    const p = document.getElementById("infoPanel");
    p.textContent = t;
    p.style.opacity = 1;
    setTimeout(()=>{ p.style.opacity = 0; },2500);
}

/* DPAD – NE SME DA SE MENJA */
document.addEventListener("keydown", e => {

    switch(e.key){

        case "ArrowLeft":
            player.seekTo(player.getCurrentTime() - 60, true);
            break;

        case "ArrowRight":
            player.seekTo(player.getCurrentTime() + 60, true);
            break;

        case "Enter":
            if (isPlaying) player.pauseVideo();
            else player.playVideo();
            break;

        case "Backspace":
        case "Escape":
            history.back();
            break;
    }
});
</script>

</body>
</html>
