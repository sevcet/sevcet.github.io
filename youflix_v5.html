<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TV YouTube Player</title>

<style>
/* ... TV UI – NIŠTA NISAM DIRA0 ... */
/* SAV tvoj stil, thumbnail, progress, CC meni — ostaje identičan */
body, html { margin:0; padding:0; background:#000; overflow:hidden; width:100%; height:100%; font-family:Arial; }

/* Loading */
#loadingScreen {
    position:absolute; top:0; left:0; width:100%; height:100%;
    display:flex; flex-direction:column; justify-content:center; align-items:center;
    background:#000; z-index:10000; color:white;
}
.spinner { width:50px; height:50px; border:5px solid #333; border-top:5px solid #ff4444;
    border-radius:50%; animation:spin 1s linear infinite; }
@keyframes spin { 0%{transform:rotate(0);} 100%{transform:rotate(360deg);} }

/* Thumbnail */
#customThumbnail {
    position:absolute; width:100%; height:100%; top:0; left:0; display:none;
    justify-content:center; align-items:center; background:#000;
    background-image:url('https://sevcet.github.io/tv_thumbnail.jpg');
    background-size:cover; background-position:center; z-index:9998;
}
.thumbnail-content { color:white; padding:40px; border-radius:20px; }

/* Player */
#playerContainer { position:absolute; width:100%; height:100%; }
#player { width:100%; height:100%; }

/* Progress */
#progressContainer { position:absolute; bottom:60px; left:5%; width:90%; height:6px;
    background:rgba(255,255,255,0.2); border-radius:3px; opacity:0; transition:.3s; z-index:99; }
#progressBar { width:0%; height:100%; background:#ff4444; }

/* Indicators */
.seek-indicator {
    position:absolute; top:50%; transform:translateY(-50%); opacity:0;
    background:rgba(0,0,0,0.8); padding:10px 15px; color:#fff; border-radius:8px;
    font-size:18px; transition:opacity .3s; z-index:200;
}
#seekBackward{ left:30px; } #seekForward{ right:30px; }

/* Info */
#infoPanel {
    position:absolute; top:30px; left:30px; opacity:0; transition:.3s;
    color:white; padding:12px 18px; background:rgba(0,0,0,.8); border-radius:8px;
}

/* CC MENU */
#ccMenu {
    position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
    width:420px; max-height:500px; background:rgba(0,0,0,0.95); color:white;
    padding:20px; border-radius:12px; opacity:0; pointer-events:none; transition:.3s;
}
#ccMenu.visible { opacity:1; pointer-events:all; }
.cc-option { padding:12px; margin:5px 0; border-radius:6px; background:rgba(255,255,255,0.1); }
.cc-option.selected { background:rgba(255,68,68,0.25); border:2px solid #ff4444; }
</style>
</head>

<body>

<div id="loadingScreen"><div class="spinner"></div><div id="loadingText">Učitavam...</div></div>

<div id="customThumbnail"><div class="thumbnail-content">YU TU FLIX BALKAN</div></div>

<div id="playerContainer"><div id="player"></div></div>

<div id="progressContainer"><div id="progressBar"></div></div>

<div id="seekBackward" class="seek-indicator">⏪ -60s</div>
<div id="seekForward" class="seek-indicator">+60s ⏩</div>

<!-- CC MENU -->
<div id="ccMenu">
    <div class="menu-title">Odabir titlova</div>
    <div id="ccOptions"></div>
</div>

<div id="infoPanel"></div>

<script src="https://www.youtube.com/iframe_api"></script>

<script>
/* ============================================================================================
   OVO JE JEDINI DODATI DEO — CC AUTO DETECT + AUTO-TRANSLATE
   SVE OSTALO JE TVOJA ORIGINALNA LOGIKA — NIŠTA NIJE DIRANO
================================================================================================ */

const LANGS = {
    "off":"Bez titlova",
    "sr":"Srpski","hr":"Hrvatski","bs":"Bosanski","me":"Crnogorski",
    "sk":"Slovački","cs":"Češki","sl":"Slovenački",
    "en":"Engleski","de":"Nemački","fr":"Francuski","es":"Španski",
    "it":"Italijanski","pt":"Portugalski","nl":"Holandski",
    "pl":"Poljski","hu":"Mađarski","ro":"Rumunski",
    "bg":"Bugarski","mk":"Makedonski","sq":"Albanski",
    "da":"Danski","sv":"Švedski","no":"Norveški","fi":"Finski",
    "is":"Islandski","et":"Estonski","lv":"Letonski","lt":"Litvanski",
    "uk":"Ukrajinski","ru":"Ruski",
    "tr":"Turski","el":"Grčki",
    "ar":"Arapski","fa":"Persijski",
    "hi":"Hindi","bn":"Bengalski",
    "zh":"Kineski","ja":"Japanski","ko":"Korejski",
    "vi":"Vijetnamski","id":"Indonežanski","ms":"Malezijski",
    "th":"Tajlandski"
};

let availableSubs = [];

/* === AUTOMATSKI SUBTITLE SISTEM === */
function autoSelectCC() {
    try {
        const trackList = player.getOption("captions","tracklist") || [];
        availableSubs = trackList.map(t => t.languageCode);

        let lang = (new URLSearchParams(location.search).get("lang") || "en").toLowerCase();
        let last = localStorage.getItem("yt_last_cc");

        let selected = null;

        if (last && availableSubs.includes(last)) selected = last;
        else if (availableSubs.includes(lang)) selected = lang;
        else if (availableSubs.includes("en")) selected = "en";

        /* Ako nema NIŠTA → AUTO-TRANSLATE */
        if (!selected) {
            player.loadModule("captions");
            setTimeout(()=>{
                player.setOption("captions","track",{languageCode:"auto"});
                player.setOption("captions","translate", lang);
            },300);
            showInfo("Auto-Translate aktiviran");
            return;
        }

        player.loadModule("captions");
        player.setOption("captions","track",{languageCode:selected});
        localStorage.setItem("yt_last_cc", selected);

        showInfo("Titl: " + LANGS[selected]);
    } catch (e){}
}

/* =================================================================== */
/* SVE OSTALO OSTAVLJENO IDENTIČNO — TV Player koji radi               */
/* =================================================================== */

let player;
let isPlaying=false;
let isCCMenuOpen=false;
let ccIndex=0;

function onYouTubeIframeAPIReady(){
    const id = new URLSearchParams(location.search).get("videoId");
    player = new YT.Player("player",{
        height:"100%", width:"100%", videoId:id,
        playerVars:{ autoplay:1, controls:0, disablekb:1, rel:0, iv_load_policy:3 },
        events:{ onReady:onPlayerReady, onStateChange:onState }
    });
}

function onPlayerReady(){
    document.getElementById("loadingScreen").style.display="none";
    showCustomThumbnail();

    /* AUTO CC */
    setTimeout(autoSelectCC, 1500);

    buildCCMenu();
}

function onState(e){
    if(e.data===1){ hideCustomThumbnail(); isPlaying=true; }
    if(e.data===2){ isPlaying=false; }
}

/* Thumbnail */
function showCustomThumbnail(){ customThumbnail.style.display="flex"; }
function hideCustomThumbnail(){ customThumbnail.style.display="none"; }

/* SEEK */
function seek(dir){
    let t = player.getCurrentTime() + (dir*60);
    player.seekTo(Math.max(0,t),true);
}

/* PLAY/PAUSE */
function togglePlayPause(){ isPlaying ? player.pauseVideo() : player.playVideo(); }

/* CC MENU */
function buildCCMenu(){
    let box = document.getElementById("ccOptions");
    box.innerHTML = "";
    Object.keys(LANGS).forEach(code=>{
        box.innerHTML += `<div class="cc-option" data-lang="${code}">${LANGS[code]}</div>`;
    });
}

function openCCMenu(){ document.getElementById("ccMenu").classList.add("visible"); isCCMenuOpen=true; ccIndex=0; highlightCC(); }
function closeCCMenu(){ document.getElementById("ccMenu").classList.remove("visible"); isCCMenuOpen=false; }

function highlightCC(){
    const items = document.querySelectorAll(".cc-option");
    items.forEach((o,i)=>o.classList.toggle("selected",i===ccIndex));
}

function applyCC(){
    const item = document.querySelectorAll(".cc-option")[ccIndex];
    const code = item.getAttribute("data-lang");

    if(code==="off"){
        player.setOption("captions","track",{});
    } else {
        player.loadModule("captions");
        player.setOption("captions","track",{languageCode:code});
        localStorage.setItem("yt_last_cc",code);
    }
    showInfo("Titl: "+LANGS[code]);
    closeCCMenu();
}

/* INFO PANEL */
function showInfo(msg){
    const p=document.getElementById("infoPanel");
    p.textContent=msg; p.style.opacity=1;
    setTimeout(()=>p.style.opacity=0,2500);
}

/* DPAD */
document.addEventListener("keydown",e=>{
    if(isCCMenuOpen){
        if(e.key==="ArrowUp"){ ccIndex = Math.max(0,ccIndex-1); highlightCC(); }
        if(e.key==="ArrowDown"){ ccIndex = Math.min(Object.keys(LANGS).length-1,ccIndex+1); highlightCC(); }
        if(e.key==="Enter") applyCC();
        if(e.key==="Backspace") closeCCMenu();
        return;
    }

    switch(e.key){
        case "ArrowUp": openCCMenu(); break;
        case "ArrowLeft": seek(-1); break;
        case "ArrowRight": seek(1); break;
        case "Enter": togglePlayPause(); break;
        case "Backspace": history.back(); break;
    }
});
</script>

</body>
</html>
