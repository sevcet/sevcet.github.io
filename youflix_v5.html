<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YouFlix Player v5</title>

<style>
    body, html {
        margin: 0; padding: 0;
        background: #000;
        overflow: hidden;
        width: 100%; height: 100%;
        font-family: Arial, sans-serif;
    }

    /* Loading */
    #loadingScreen {
        position: absolute; top: 0; left: 0;
        width: 100%; height: 100%;
        background: #000;
        display: flex; flex-direction: column;
        justify-content: center; align-items: center;
        z-index: 10000; color: white;
    }
    .spinner {
        width: 50px; height: 50px;
        border: 5px solid #333;
        border-top: 5px solid #ff4444;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    #loadingText { margin-top: 20px; font-size: 18px; }

    /* Thumbnail */
    #customThumbnail {
        position: absolute; top: 0; left: 0;
        width: 100%; height: 100%;
        background-size: cover; background-position: center;
        background-color: #000;
        background-image: url('https://sevcet.github.io/tv_thumbnail.jpg');
        z-index: 9998;
        display: none;
        justify-content: center;
        align-items: center;
    }
    .thumbnail-content {
        text-align: center; color: white;
        background: rgba(0,0,0,0.8);
        padding: 40px; border-radius: 20px;
        backdrop-filter: blur(15px);
        border: 2px solid rgba(255,68,68,0.5);
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }

    /* Player */
    #playerContainer {
        width: 100%; height: 100%;
        position: relative;
    }

    #player {
        width: 100%; height: 100%;
        border: none;
    }

    /* Progress */
    #progressContainer {
        position: absolute; bottom: 60px; left: 5%;
        width: 90%; height: 6px;
        background: rgba(255,255,255,0.2);
        border-radius: 3px;
        z-index: 10001; opacity: 0;
        transition: opacity .3s;
    }
    #progressBar {
        height: 100%; width: 0%;
        background: #ff4444;
        border-radius: 3px;
    }

    /* Seek indicators */
    .seek-indicator {
        position: absolute; top: 50%; transform: translateY(-50%);
        background: rgba(0,0,0,0.8);
        padding: 10px 15px;
        color: white; border-radius: 8px;
        font-size: 18px; opacity: 0;
        z-index: 10001; transition: opacity .3s;
    }
    #seekBackward { left: 30px; }
    #seekForward { right: 30px; }

    /* Info panel */
    #infoPanel {
        position: absolute; top: 30px; left: 30px;
        background: rgba(0,0,0,0.8);
        color: white; padding: 12px 18px;
        border-radius: 8px;
        border-left: 4px solid #ff4444;
        font-size: 16px;
        opacity: 0; transition: opacity .3s;
        z-index: 10001;
    }

    /* CC MENU v5 */
    #ccMenu {
        position: absolute;
        top: 50%; left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0,0,0,0.95);
        color: white;
        padding: 20px;
        border-radius: 12px;
        width: 450px;
        max-height: 500px;
        opacity: 0; pointer-events: none;
        transition: opacity .3s;
        z-index: 10002;
        display: flex; flex-direction: column;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }
    #ccMenu.visible {
        opacity: 1; pointer-events: all;
    }
    .menu-title {
        font-size: 20px; text-align: center;
        color: #ff4444;
        margin-bottom: 15px;
        border-bottom: 2px solid #333;
        padding-bottom: 10px;
    }
    .cc-options-container {
        flex: 1; overflow-y: auto;
        max-height: 400px;
    }
    .cc-option {
        padding: 12px 15px;
        margin: 5px 0;
        background: rgba(255,255,255,0.10);
        border-radius: 6px;
        border: 2px solid transparent;
        transition: .2s;
    }
    .cc-option.selected {
        background: rgba(255,68,68,0.25);
        border-color: #ff4444;
    }
</style>
</head>

<body>

<!-- Loading -->
<div id="loadingScreen">
    <div class="spinner"></div>
    <div id="loadingText">Uƒçitavam YouTube player...</div>
</div>

<!-- Thumbnail -->
<div id="customThumbnail">
    <div class="thumbnail-content">
        <div class="thumbnail-text">YU TU FLIX BALKAN<br>Uƒçitavam video...</div>
    </div>
</div>

<!-- Player -->
<div id="playerContainer">
    <div id="player"></div>
</div>

<!-- Progress -->
<div id="progressContainer"><div id="progressBar"></div></div>

<!-- Seek -->
<div id="seekBackward" class="seek-indicator">‚è™ -60s</div>
<div id="seekForward" class="seek-indicator">+60s ‚è©</div>

<!-- CC Menu -->
<div id="ccMenu">
    <div class="menu-title">üéØ Odabir titlova</div>
    <div id="ccOptions" class="cc-options-container"></div>
</div>

<div id="infoPanel"></div>

<script src="https://www.youtube.com/iframe_api"></script>

<script>
let player;
let progressInterval;
let isPlaying = false;
let customThumbnail;
let isCCMenuOpen = false;
let ccIndex = 0;

/* ------------------------- 42 LANGUAGE LIST ------------------------- */
const LANG_LIST = {
    "off":"‚ùå Bez titlova",
    "sr":"üá∑üá∏ Srpski","hr":"üá≠üá∑ Hrvatski","bs":"üáßüá¶ Bosanski","me":"üá≤üá™ Crnogorski",
    "sk":"üá∏üá∞ Slovaƒçki","cs":"üá®üáø ƒåe≈°ki","sl":"üá∏üáÆ Slovenaƒçki",
    "en":"üá∫üá∏ Engleski","de":"üá©üá™ Nemaƒçki","fr":"üá´üá∑ Francuski","es":"üá™üá∏ ≈†panski",
    "it":"üáÆüáπ Italijanski","pt":"üáµüáπ Portugalski","nl":"üá≥üá± Holandski",
    "pl":"üáµüá± Poljski","hu":"üá≠üá∫ Maƒëarski","ro":"üá∑üá¥ Rumunski",
    "bg":"üáßüá¨ Bugarski","mk":"üá≤üá∞ Makedonski","sq":"üá¶üá± Albanski",
    "da":"üá©üá∞ Danski","sv":"üá∏üá™ ≈†vedski","no":"üá≥üá¥ Norve≈°ki","fi":"üá´üáÆ Finski",
    "is":"üáÆüá∏ Islandski","et":"üá™üá™ Estonski","lv":"üá±üáª Letonski","lt":"üá±üáπ Litvanski",
    "uk":"üá∫üá¶ Ukrajinski","ru":"üá∑üá∫ Ruski",
    "tr":"üáπüá∑ Turski","el":"üá¨üá∑ Grƒçki",
    "ar":"üá∏üá¶ Arapski","fa":"üáÆüá∑ Persijski",
    "hi":"üáÆüá≥ Hindi","bn":"üáßüá© Bengalski",
    "zh":"üá®üá≥ Kineski","ja":"üáØüáµ Japanski","ko":"üá∞üá∑ Korejski",
    "vi":"üáªüá≥ Vijetnamski","id":"üáÆüá© Indone≈æanski","ms":"üá≤üáæ Malezijski",
    "th":"üáπüá≠ Tajlandski"
};

/* ------------------------- AUTO CC LOGIC ------------------------- */
function autoSelectSubtitles() {
    try {
        const preferred = ["sr","bs","hr","me","sk","cs","sl","en"];
        let tracks = player.getOption("captions","tracklist") || [];

        let available = tracks.map(t => t.languageCode);
        let found = null;

        // last used
        const last = localStorage.getItem("yt_last_cc");
        if (last && available.includes(last)) {
            found = last;
        }

        // preferred
        if (!found) {
            for (let p of preferred) {
                if (available.includes(p)) {
                    found = p;
                    break;
                }
            }
        }

        // english fallback
        if (!found && available.includes("en"))
            found = "en";

        if (found) {
            player.loadModule("captions");
            player.setOption("captions","track",{ languageCode:found });
            localStorage.setItem("yt_last_cc", found);
            showInfo("Automatski titl: " + LANG_LIST[found]);
        }

    } catch(e){ console.log("AUTO CC ERR:", e); }
}

/* ------------------------- CC MENU ------------------------- */
function buildCCMenu() {
    const container = document.getElementById("ccOptions");
    container.innerHTML = "";

    for (let code in LANG_LIST) {
        container.innerHTML += `
            <div class="cc-option" data-lang="${code}">
                ${LANG_LIST[code]}
            </div>`;
    }
}

function openCCMenu() {
    document.getElementById("ccMenu").classList.add("visible");
    isCCMenuOpen = true;
    ccIndex = 0;
    highlightCC();
}

function closeCCMenu() {
    document.getElementById("ccMenu").classList.remove("visible");
    isCCMenuOpen = false;
}

function highlightCC() {
    const options = document.querySelectorAll(".cc-option");
    options.forEach((o,i)=>o.classList.toggle("selected", i===ccIndex));
}

function applyCC() {
    const option = document.querySelectorAll(".cc-option")[ccIndex];
    const lang = option.getAttribute("data-lang");

    if (lang === "off") {
        player.setOption("captions","track",{});
        showInfo("Titlovi iskljuƒçeni");
    } else {
        player.loadModule("captions");
        player.setOption("captions","track",{ languageCode:lang });
        localStorage.setItem("yt_last_cc", lang);
        showInfo("Titl: " + LANG_LIST[lang]);
    }
    closeCCMenu();
}

/* ------------------------- YOUTUBE PLAYER ------------------------- */
function onYouTubeIframeAPIReady() {
    const id = new URLSearchParams(location.search).get("videoId");
    customThumbnail = document.getElementById("customThumbnail");

    player = new YT.Player("player", {
        height:"100%", width:"100%",
        videoId:id,
        playerVars:{
            autoplay:1, controls:0, rel:0,
            fs:1, disablekb:1, modestbranding:1,
            iv_load_policy:3
        },
        events:{
            onReady:onPlayerReady,
            onStateChange:onState
        }
    });
}

function onPlayerReady() {
    document.getElementById("loadingScreen").style.display="none";
    showCustomThumbnail();
    buildCCMenu();

    setTimeout(autoSelectSubtitles, 1500);

    showInfo("‚Üê‚Üí 60s | ‚Üë CC meni | ENTER pauza/play | BACK zatvori");
}

function onState(e) {
    if (e.data === YT.PlayerState.PLAYING) {
        hideCustomThumbnail();
        isPlaying = true;
    }
    if (e.data === YT.PlayerState.PAUSED)
        isPlaying = false;
}

/* ------------------------- THUMBNAIL ------------------------- */
function showCustomThumbnail(){ customThumbnail.style.display="flex"; }
function hideCustomThumbnail(){ customThumbnail.style.display="none"; }

/* ------------------------- SEEK ------------------------- */
function seek(dir) {
    const sec = 60;
    const t = player.getCurrentTime() + sec * dir;
    player.seekTo(Math.max(0,t), true);

    document.getElementById(dir<0?"seekBackward":"seekForward").style.opacity = "1";
    setTimeout(()=>{
        document.getElementById(dir<0?"seekBackward":"seekForward").style.opacity = "0";
    }, 800);
}

/* ------------------------- PLAY/PAUSE ------------------------- */
function togglePlayPause(){
    if (isPlaying) player.pauseVideo();
    else player.playVideo();
}

/* ------------------------- INFO PANEL ------------------------- */
function showInfo(msg){
    const p=document.getElementById("infoPanel");
    p.textContent=msg;
    p.style.opacity=1;
    setTimeout(()=>p.style.opacity=0,2500);
}

/* ------------------------- DPAD ------------------------- */
document.addEventListener("keydown", e => {

    if (isCCMenuOpen) {
        if (e.key==="ArrowUp") { ccIndex = Math.max(0,ccIndex-1); highlightCC(); }
        if (e.key==="ArrowDown") { ccIndex = Math.min(Object.keys(LANG_LIST).length-1,ccIndex+1); highlightCC(); }
        if (e.key==="Enter") applyCC();
        if (e.key==="Backspace") closeCCMenu();
        return;
    }

    switch(e.key){
        case "ArrowLeft": seek(-1); break;
        case "ArrowRight": seek(1); break;
        case "ArrowUp": openCCMenu(); break;
        case "Enter": togglePlayPause(); break;
        case "Backspace": history.back(); break;
    }
});
</script>

</body>
</html>
